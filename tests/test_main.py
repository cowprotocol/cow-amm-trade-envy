import pandas as pd
from main import calc_envy


def test_calc_envy():
    row_as_dict = {
        "call_tx_hash": "0x9a9d29cf57eec2c3ac8e5cf4e1984ddf30eb9b708af5380c350dd395b60da747",
        "call_block_number": 20842716,
        "gas_price": 22512333999,
        "tokens": "[0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48 0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2 0xcd5fe23c85820f7b72d0926fc9b05b43e359b7ee 0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2 0xcd5fe23c85820f7b72d0926fc9b05b43e359b7ee 0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48 0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2]",
        "clearingPrices": "[675702271894863831239753728 1802379882825404416 1882610587446793687 1795746521597806075 1882610587446793687 408804721466143689 1095366441]",
        "trades": '[{"sellTokenIndex":3,"buyTokenIndex":4,"receiver":"0xba3eff3dd2b4442b6c141c5008260dc18824f2f1","sellAmount":8347127038529613057,"buyAmount":7959236045049141939,"validTo":1727451436,"appData":"0x924f5e36ae70c8cdad505bc4807be76099024df2520e89d14478e42c52084441","feeAmount":0,"flags":2,"executedAmount":1882610587446793687,"signature":"0x42f03167a200d107ece818f3f73ba5d5166698550cfea474a445065149e2eb1971664e5961d90d4bd21130c4c039801b3763aa3ae3a725049e1d3474407e701e1c"} {"sellTokenIndex":5,"buyTokenIndex":6,"receiver":"0x0000000000000000000000000000000000000000","sellAmount":1095366441,"buyAmount":408422025712910370,"validTo":1727449487,"appData":"0x362e5182440b52aa8fffe70a251550fbbcbca424740fe5a14f59bf0c1b06fe1d","feeAmount":0,"flags":66,"executedAmount":1095366441,"signature":"0xf08d4dea369c456d26a3168ff0024b904f2d8b91000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004149f72900000000000000000000000000000000000000000000000005ab01ab211040220000000000000000000000000000000000000000000000000000000066f6c98f362e5182440b52aa8fffe70a251550fbbcbca424740fe5a14f59bf0c1b06fe1d0000000000000000000000000000000000000000000000000000000000000000f3b277728b3fee749481eb3e0b3b48980dbbab78658fc419025cb16eee34677500000000000000000000000000000000000000000000000000000000000000015a28e9363bb942b639270062aa6bb295f434bcdfc42c97267bf003f272060dc95a28e9363bb942b639270062aa6bb295f434bcdfc42c97267bf003f272060dc9"}]',
    }
    row_as_series = pd.Series(row_as_dict)
    result = calc_envy(row_as_series)
    assert int(result) == -4676949075581188
